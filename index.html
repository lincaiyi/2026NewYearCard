<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>2026 ä¸™åˆé¦¬å¹´ Â· è³€ç¦®é›†</title>

<style>
:root{
  --env-red:#9e0b0f;
  --env-dark:#4a0404;
  --gold-main:linear-gradient(135deg,#bf953f,#fcf6ba,#b38728,#fbf5b7,#aa771c);
  --gold-text:linear-gradient(to right,#bf953f 22%,#fcf6ba 45%,#b38728 50%,#fcf6ba 55%,#bf953f 78%);
  --bg-dark:#0a0202;
}

body{
  margin:0; height:100vh; display:flex; flex-direction: column; align-items:center; justify-content:center;
  background: var(--bg-dark);
  perspective: 2000px; font-family:"Noto Serif TC",serif;
  overflow:hidden;
}

body::before {
  content: ''; position: absolute; inset: 0;
  background: radial-gradient(circle at center, #3d0505 0%, var(--bg-dark) 80%), url('https://www.transparenttextures.com/patterns/60-lines.png');
  opacity: 0.6; z-index: -2;
}

.particle {
  position: absolute; background: var(--gold-main);
  pointer-events: none; border-radius: 1px; opacity: 0; z-index: -1;
  animation: fall linear infinite;
}
@keyframes fall {
  0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
  20% { opacity: 0.6; }
  100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
}

/* éŸ³æ¨‚æ§åˆ¶æŒ‰éˆ•ï¼šé è¨­å°±æ˜¯é–‹å•Ÿç‹€æ…‹ */
#music-control {
  position: fixed; top: calc(20px + env(safe-area-inset-top)); left: 25px;
  width: 40px; height: 40px; z-index: 300; cursor: pointer;
  background: rgba(0,0,0,0.3); border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  border: 1px solid #bf953f; transition: 0.3s;
  animation: pulse 2s infinite; /* ä¸€é–‹å§‹å°±è®“å®ƒé–ƒå‹•ï¼Œæç¤ºå¯ä»¥äº’å‹• */
}
#music-control:active { transform: scale(0.9); }
#music-control svg { width: 20px; height: 20px; fill: #bf953f; }
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(191,149,63,0.4); } 70% { box-shadow: 0 0 0 10px rgba(191,149,63,0); } 100% { box-shadow: 0 0 0 0 rgba(191,149,63,0); } }

#container{
  position:relative; width:90vw; max-width:400px; height:280px; 
  margin-top: 40px; 
}

.card-system{
  position:absolute; width:100%; height:100%; cursor:pointer;
  transition:.8s cubic-bezier(.34,1.56,.64,1);
  visibility:hidden; opacity:0;
  transform:translateY(50px) scale(.8);
  --x:50%; --y:50%; left:0; top:0;
}
.card-system.active{ visibility:visible; opacity:1; transform:none; z-index:100; }
.card-system.exit-up{ opacity:0; transform:translateY(-800px) rotate(-10deg) scale(1.1) }
.card-system.queue-down{ opacity:0; transform:translateY(400px) scale(.85) }

.envelope-back{position:absolute; inset:0; background:var(--env-dark); border-radius:4px; box-shadow:0 25px 50px rgba(0,0,0,0.8)}
.envelope-front{position:absolute; inset:0; background:var(--env-red);
clip-path:polygon(0 35%, 50% 70%, 100% 35%, 100% 100%, 0 100%); z-index:10;
box-shadow: inset 0 -10px 30px rgba(0,0,0,0.2);
}
.envelope-front::after{
  content:''; position:absolute; inset:0; background:var(--gold-main);
  clip-path:polygon(0 35%, 50% 70%, 100% 35%, 100% 36.5%, 50% 71.5%, 0 36.5%)
}

.lid{position:absolute; inset:0; transform-origin:top; transition:.6s ease; z-index:15}
.lid::before{
  content:''; position:absolute;
  border-left:45vw solid transparent; border-right:45vw solid transparent;
  border-top:150px solid #820000; left:50%; transform:translateX(-50%);
}
@media(min-width:467px){ .lid::before{ border-left:200px solid transparent; border-right:200px solid transparent; } }

.seal{
  position:absolute; top:105px; left:50%; transform:translateX(-50%);
  width:68px; height:68px; border-radius:50%;
  background:var(--gold-main); display:flex; flex-direction:column; align-items:center; justify-content:center;
  box-shadow:0 8px 20px rgba(0,0,0,0.5); z-index:20; border: 1px solid rgba(255,255,255,0.4);
}
.seal::before { content: 'ğŸ'; font-size: 24px; }
.seal::after { content: 'ä¸™åˆ'; font-size: 10px; font-weight: bold; color: #5a0000; letter-spacing: 2px;}

.letter{
  position:absolute; bottom:5px; left:50%; transform:translateX(-50%);
  width:92%; height:260px; padding:20px; box-sizing:border-box;
  background:#fffdf5 url('https://www.transparenttextures.com/patterns/paper-fibers.png');
  border:1px solid #e0d5b0; border-radius:2px;
  clip-path:inset(100% 0 0 0); transition:.8s cubic-bezier(.4,0,.2,1);
  z-index:5; display:flex; flex-direction:column; align-items:center;
}

.card-system.break-seal .seal{animation:sealBreak .5s ease forwards}
@keyframes sealBreak{ 100%{transform:translateX(-50%) scale(0); opacity:0} }
.card-system.open-lid .lid{transform:rotateX(160deg); z-index:1}
.card-system.pull-letter .letter{
  transform:translateX(-50%) translateY(-210px);
  clip-path:inset(0 0 0 0); box-shadow:0 20px 40px rgba(0,0,0,.5);
}

.title{
  margin:0 0 8px 0; font-size:20px; letter-spacing:3px; font-weight:900;
  background:var(--gold-text); background-size:200% auto;
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  animation:shine 3s linear infinite; text-align: center;
}
.text{margin-top:10px; text-align:center; line-height:1.8; color:#444; font-size:15px; flex-grow: 1;}
.line{opacity:0; transform:translateY(8px); animation:lineIn .7s ease forwards}
@keyframes lineIn{to{opacity:1; transform:none}}
.signature{margin-top:8px; align-self:flex-end; font-weight:bold; color:#8b0000; font-size:13px; border-bottom: 1.5px solid #8b0000;}

.bottom-ui {
  position: fixed;
  bottom: calc(80px + env(safe-area-inset-bottom));
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  z-index: 50;
  pointer-events: none;
}

.zodiac-decor {
  background: var(--gold-text);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-size: 22px;
  font-weight: 700;
  letter-spacing: 6px;
  text-shadow: 0 0 15px rgba(191,149,63,0.4);
}

.hint {
  color: #bf953f;
  letter-spacing: 4px;
  font-size: 13px;
  opacity: 0.8;
  animation: breath 2.5s ease-in-out infinite;
}

.counter{
  position:fixed; top:calc(20px + env(safe-area-inset-top)); right:25px;
  color:#bf953f; font-size:14px; z-index:200;
}

@keyframes breath { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
@keyframes shine{to{background-position:200% center}}

@media (max-height: 667px) {
  #container { margin-top: 60px; transform: scale(0.9); }
  .bottom-ui { bottom: calc(20px + env(safe-area-inset-bottom)); }
}
</style>
</head>

<body>

<div id="music-control" onclick="toggleMusic()">
  <svg id="icon-play" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
  <svg id="icon-mute" viewBox="0 0 24 24" style="display:none;"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
</div>

<audio id="bgm" loop preload="auto">
  <source src="audio_3588744925.mp3" type="audio/mpeg">
</audio>

<div class="counter" id="counter"></div>
<div id="container"></div>

<div class="bottom-ui">
  <div class="zodiac-decor">äºŒé›¶äºŒå…­ Â· ä¸™åˆé¦¬å¹´</div>
  <div class="hint">âœ¦ æ»‘å‹•åˆ‡æ› Â· é»æ“Šæ‹†å° âœ¦</div>
</div>

<script>
const wishes=[
  {to:"å°Šè²´çš„åˆä½œå¤¥ä¼´",from:"ç‹å¤§æ˜",wish:["ç¥æ‚¨æ–°çš„ä¸€å¹´","é¾é¦¬ç²¾ç¥ï¼Œæ­¥æ­¥é«˜å‡","äº‹æ¥­é¨°é£›å‰µè¼ç…Œã€‚"]},
  {to:"æ•¬æ„›çš„é•·è¼©",from:"æå°è¯",wish:["é¡˜ 2026 ä¸™åˆå¹´","ç¦é¦¬è¿ç¥¥ï¼Œèº«é«”åº·å¥","è¬äº‹é †é‚å¹³å®‰ã€‚"]},
  {to:"è¦ªæ„›çš„æœ‹å‹",from:"å¼µç¶“ç†",wish:["æ„Ÿè¬ä¸€è·¯ä¸¦è‚©","è²¡æºå»£é€²ï¼Œç¦æ°£æ»¿é–€","å¥½é‹å¥”é¨°è€Œä¾†ã€‚"]}
];

let currentIndex=0;
let isMusicInitiated = false;
const container=document.getElementById("container");
const counter=document.getElementById("counter");
const bgm = document.getElementById("bgm");
const iconPlay = document.getElementById("icon-play");
const iconMute = document.getElementById("icon-mute");

// é€™æ˜¯æ ¸å¿ƒå•Ÿå‹•å™¨ï¼šåªè¦ä½¿ç”¨è€…ä¸€ç¢°è¢å¹•å°±é–‹éŸ³æ•ˆ
function initiateAudio() {
  if (!isMusicInitiated) {
    bgm.play().then(() => {
      isMusicInitiated = true;
      console.log("Audio started via user interaction");
    }).catch(err => console.log("Waiting for user..."));
  }
}

// ç›£è½æ‰€æœ‰å¯èƒ½çš„äº’å‹•
["click", "touchstart", "wheel", "mousedown"].forEach(event => {
  window.addEventListener(event, initiateAudio, { once: true });
});

function toggleMusic() {
  isMusicInitiated = true; // ä½¿ç”¨è€…æ‰‹å‹•æ“ä½œæŒ‰éˆ•ä¹Ÿç®—äº’å‹•
  if (bgm.paused) {
    bgm.play();
    iconPlay.style.display = "block";
    iconMute.style.display = "none";
    document.getElementById("music-control").style.animation = "pulse 2s infinite";
  } else {
    bgm.pause();
    iconPlay.style.display = "none";
    iconMute.style.display = "block";
    document.getElementById("music-control").style.animation = "none";
  }
}

function createParticles() {
  for (let i = 0; i < 20; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = Math.random() * 4 + 2 + 'px';
    p.style.width = size; p.style.height = size;
    p.style.left = Math.random() * 100 + 'vw';
    p.style.animationDuration = Math.random() * 6 + 4 + 's';
    p.style.animationDelay = Math.random() * 5 + 's';
    document.body.appendChild(p);
  }
}

const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function paperSound(){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type="triangle";o.frequency.value=180;
  g.gain.value=0.015;
  o.connect(g);g.connect(audioCtx.destination);
  o.start();o.stop(audioCtx.currentTime+.08);
}

function updateView(){
 document.querySelectorAll(".card-system").forEach((c,i)=>{
  c.className="card-system";
  if(i===currentIndex)c.classList.add("active");
  else if(i<currentIndex)c.classList.add("exit-up");
  else c.classList.add("queue-down");
 });
 counter.innerText=`NÂº ${currentIndex+1} / ${wishes.length}`;
}

function initCards(){
 wishes.forEach(item=>{
  const card=document.createElement("div");
  card.className="card-system";
  card.dataset.step=0;
  const lines=item.wish.map((t,i)=>`<div class="line" style="animation-delay:${(i+1)*.3}s">${t}</div>`).join("");
  card.innerHTML=`
    <div class="lid"></div>
    <div class="seal"></div>
    <div class="envelope-back"></div>
    <div class="envelope-front"></div>
    <div class="letter">
     <h1 class="title">ç¥è³€ ${item.to}</h1>
     <div class="text">${lines}</div>
     <div class="signature">${item.from} æ•¬è³€</div>
    </div>`;
  card.onclick=()=>{
    initiateAudio(); // é»æ“Šå¡ç‰‡ä¹Ÿå˜—è©¦å•Ÿå‹• BGM
    if(!card.classList.contains("active"))return;
    const step=+card.dataset.step;
    if(step===0)card.classList.add("break-seal");
    if(step===1)card.classList.add("open-lid");
    if(step===2){card.classList.add("pull-letter");paperSound();}
    card.dataset.step=Math.min(step+1,3);
  };
  container.appendChild(card);
 });
 updateView();
 createParticles();
}

function change(dir){
 initiateAudio(); // åˆ‡æ›å¡ç‰‡ä¹Ÿå˜—è©¦å•Ÿå‹• BGM
 const active=document.querySelector(".active");
 if(active){
   active.classList.remove("break-seal","open-lid","pull-letter");
   active.dataset.step=0;
 }
 if(dir==="next"&&currentIndex<wishes.length-1)currentIndex++;
 if(dir==="prev"&&currentIndex>0)currentIndex--;
 updateView();
}

window.addEventListener("wheel",e=>{ if(Math.abs(e.deltaY)>30)change(e.deltaY>0?"next":"prev"); });
let startY=0;
window.addEventListener("touchstart",e=>startY=e.touches[0].clientY);
window.addEventListener("touchend",e=>{
 const d=startY-e.changedTouches[0].clientY;
 if(Math.abs(d)>50)change(d>0?"next":"prev");
});

container.addEventListener("mousemove",e=>{
 const c=document.querySelector(".active");
 if(!c)return;
 const r=c.getBoundingClientRect();
 c.style.setProperty("--x",`${e.clientX-r.left}px`);
 c.style.setProperty("--y",`${e.clientY-r.top}px`);
});

initCards();
</script>
</body>
</html>
